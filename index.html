<!--
FOLDER STRUCTURE

project-root/
‚îú‚îÄ index.html          # Homepage (entry point)
‚îú‚îÄ cars.html           # Car listings page (later)
‚îú‚îÄ car.html            # Single car template (later)
‚îú‚îÄ admin/
‚îÇ  ‚îî‚îÄ index.html       # Decap CMS admin panel
‚îú‚îÄ assets/
‚îÇ  ‚îú‚îÄ css/
‚îÇ  ‚îÇ  ‚îî‚îÄ style.css
‚îÇ  ‚îú‚îÄ images/
‚îÇ  ‚îî‚îÄ js/
‚îÇ     ‚îî‚îÄ main.js
‚îú‚îÄ content/
‚îÇ  ‚îî‚îÄ cars/            # Markdown/YAML files generated by CMS
‚îî‚îÄ admin/config.yml    # Decap CMS configuration
-->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PAB SHOP ‚Äî Cars for Sale</title>
  <meta name="description" content="Curated cars for sale ‚Äî contact us directly to purchase.">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#f6f7fb;
      --card:#ffffff;
      --muted:#6b7280;
      --text:#0f1724;
      --accent:#0b6eff;
      --glass:rgba(255,255,255,0.65);
      --shadow:0 6px 20px rgba(12,15,20,0.06);
      --border:rgba(0,0,0,0.04);
    }
    [data-theme="dark"]{
      --bg:#0b0f16;
      --card:#0f1724;
      --muted:#94a3b8;
      --text:#e6eef8;
      --accent:#4ea8ff;
      --glass:rgba(255,255,255,0.05);
      --shadow:0 10px 30px rgba(0,0,0,0.6);
      --border:rgba(255,255,255,0.03);
    }
    
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family:Inter,system-ui;
      background:var(--bg);
      color:var(--text);
      transition:background 0.4s ease, color 0.4s ease;
      line-height:1.6;
    }
    .container{max-width:1200px;margin:0 auto;padding:0 20px}

    /* HEADER PADDING: Added 10px to left and right (was 0 20px, now 10px 20px) */
    header .container{
      padding:10px 20px;
    }

    header{
      position:sticky;
      top:0;
      z-index:100;
      backdrop-filter:blur(12px) saturate(180%);
      background:var(--glass);
      border-bottom:1px solid var(--border);
      transition:all 0.4s ease;
    }
    .header-inner{
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:16px 0;
    }
    .logo{
      font-weight:700;
      color:var(--accent);
      font-size:22px;
      letter-spacing:-0.5px;
    }
    nav{display:flex;gap:8px;align-items:center}
    nav a{
      padding:10px 16px;
      color:var(--muted);
      text-decoration:none;
      font-weight:600;
      border-radius:8px;
      transition:all 0.3s cubic-bezier(0.4,0,0.2,1);
      font-size:15px;
    }
    nav a:hover{
      color:var(--text);
      background:var(--glass);
      transform:translateY(-1px);
    }

    .settings-toggle{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:50%;
      padding:10px;
      width:44px;
      height:44px;
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
      color:var(--text);
      transition:all 0.3s cubic-bezier(0.4,0,0.2,1);
      box-shadow:var(--shadow);
    }
    .settings-toggle:hover{
      transform:scale(1.08);
      box-shadow:0 8px 25px rgba(0,0,0,0.1);
    }
    .settings-toggle:active{transform:scale(0.98)}
    .settings-icon{font-size:20px;transition:transform 0.6s ease}
    .settings-toggle:hover .settings-icon{transform:rotate(90deg)}

    /* Settings Modal */
    .settings-overlay{
      position:fixed;
      top:0;
      left:0;
      width:100%;
      height:100%;
      background:rgba(0,0,0,0.5);
      backdrop-filter:blur(4px);
      z-index:1000;
      display:flex;
      align-items:center;
      justify-content:center;
      opacity:0;
      pointer-events:none;
      transition:opacity 0.3s ease;
    }
    .settings-overlay.active{
      opacity:1;
      pointer-events:all;
    }
    
    .settings-modal{
      background:var(--card);
      border-radius:20px;
      padding:32px;
      box-shadow:0 20px 60px rgba(0,0,0,0.3);
      border:1px solid var(--border);
      max-width:500px;
      width:90%;
      transform:scale(0.8) translateY(-20px);
      transition:transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    .settings-overlay.active .settings-modal{
      transform:scale(1) translateY(0);
    }
    
    .settings-header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:28px;
    }
    .settings-header h2{
      font-size:26px;
      color:var(--text);
      font-weight:700;
    }
    .close-btn{
      background:none;
      border:none;
      font-size:28px;
      color:var(--muted);
      cursor:pointer;
      transition:all 0.2s ease;
      width:36px;
      height:36px;
      display:flex;
      align-items:center;
      justify-content:center;
      border-radius:8px;
    }
    .close-btn:hover{
      background:var(--glass);
      color:var(--text);
      transform:rotate(90deg);
    }
    
    .settings-section{
      margin-bottom:28px;
    }
    .settings-section:last-child{
      margin-bottom:0;
    }
    .settings-section h3{
      font-size:16px;
      color:var(--text);
      margin-bottom:14px;
      font-weight:700;
      text-transform:uppercase;
      letter-spacing:0.5px;
      opacity:0.8;
    }
    
    .theme-buttons{
      display:flex;
      gap:12px;
    }
    .theme-btn{
      flex:1;
      padding:16px;
      border:2px solid var(--border);
      border-radius:12px;
      background:var(--card);
      cursor:pointer;
      transition:all 0.3s ease;
      font-weight:600;
      font-size:15px;
      color:var(--text);
      display:flex;
      align-items:center;
      justify-content:center;
      gap:8px;
    }
    .theme-btn:hover{
      transform:translateY(-2px);
      box-shadow:0 8px 20px rgba(0,0,0,0.1);
    }
    .theme-btn.active{
      border-color:var(--accent);
      background:var(--accent);
      color:#fff;
    }

    .hero{
      padding:60px 0 40px;
      text-align:center;
    }
    .hero h1{
      font-size:clamp(32px,6vw,52px);
      margin:0 0 12px;
      color:var(--text);
      font-weight:700;
      letter-spacing:-1px;
    }
    .hero p{
      color:var(--muted);
      font-size:18px;
      margin-bottom:30px;
    }

    .controls{
      display:flex;
      gap:14px;
      max-width:700px;
      margin:0 auto;
      flex-wrap:wrap;
      justify-content:center;
      align-items:stretch;
    }
    .search{
      flex:1;
      min-width:250px;
      background:var(--card);
      border-radius:12px;
      padding:14px 18px;
      box-shadow:var(--shadow);
      border:1px solid var(--border);
      transition:all 0.3s ease;
    }
    .search:focus-within{
      transform:translateY(-2px);
      box-shadow:0 12px 30px rgba(11,110,255,0.15);
      border-color:var(--accent);
    }
    .search input{
      border:0;
      width:100%;
      background:none;
      outline:none;
      color:var(--text);
      font-size:16px;
      font-family:inherit;
    }
    .search input::placeholder{color:var(--muted);opacity:0.7}

    .btn{
      display:inline-block;
      padding:14px 28px;
      border-radius:12px;
      background:linear-gradient(135deg,var(--accent),#2b8fff);
      color:#fff;
      text-decoration:none;
      font-weight:600;
      font-size:16px;
      transition:all 0.3s cubic-bezier(0.4,0,0.2,1);
      box-shadow:0 4px 15px rgba(11,110,255,0.3);
    }
    .btn:hover{
      transform:translateY(-3px);
      box-shadow:0 8px 25px rgba(11,110,255,0.4);
    }
    .btn:active{transform:translateY(-1px)}

    .sold-link{
      display:inline-block;
      padding:12px 24px;
      margin-top:8px;
      background:var(--card);
      border:1px solid var(--border);
      border-radius:10px;
      color:var(--muted);
      text-decoration:none;
      font-weight:600;
      font-size:15px;
      transition:all 0.3s ease;
      box-shadow:var(--shadow);
    }
    .sold-link:hover{
      color:var(--text);
      transform:translateY(-2px);
      box-shadow:0 8px 20px rgba(0,0,0,0.1);
    }

    #cars{padding:50px 20px}
    .grid{
      display:grid;
      grid-template-columns:repeat(auto-fill,minmax(320px,1fr));
      gap:28px;
      margin-top:40px;
    }





    /* Admin controls on cards */
.admin-actions{
  display:flex;
  gap:10px;
  margin-top:12px;
}

.admin-actions .mini-btn{
  flex:1;
  padding:10px 12px;
  border-radius:10px;
  border:1px solid var(--border);
  background:var(--card);
  color:var(--text);
  font-weight:700;
  cursor:pointer;
  transition:all 0.2s ease;
}

.admin-actions .mini-btn:hover{
  transform:translateY(-1px);
  box-shadow:var(--shadow);
  border-color:var(--accent);
}

.admin-actions .danger{
  border-color:rgba(239,68,68,0.35);
}

.admin-actions .danger:hover{
  border-color:rgba(239,68,68,0.8);
}

.admin-actions{
  display:flex;
  gap:10px;
  margin-top:14px;
}
.admin-actions .mini-btn{
  flex:1;
  padding:10px 12px;
  border-radius:10px;
  border:1px solid var(--border);
  background:var(--card);
  color:var(--text);
  font-weight:700;
  cursor:pointer;
}
.admin-actions .mini-btn:hover{
  transform:translateY(-1px);
  box-shadow:var(--shadow);
}
.admin-actions .danger{
  border-color: rgba(255,0,0,0.25);
  color:#ff5a5a;
}
.admin-actions .sold-btn{
  border-color: rgba(11,110,255,0.25);
}





    .card{
      background:var(--card);
      border-radius:16px;
      overflow:hidden;
      box-shadow:var(--shadow);
      transition:all 0.4s cubic-bezier(0.4,0,0.2,1);
      border:1px solid var(--border);
      cursor:pointer;
    }
    .card:hover{
      transform:translateY(-8px) scale(1.02);
      box-shadow:0 20px 40px rgba(0,0,0,0.15);
      border-color:var(--accent);
    }
    .card-img-wrap{
      position:relative;
      overflow:hidden;
      height:220px;
    }
    .card img{
      width:100%;
      height:100%;
      object-fit:cover;
      transition:transform 0.6s cubic-bezier(0.4,0,0.2,1);
    }
    .card:hover img{transform:scale(1.1)}
    
    .card-body{padding:20px}
    /* Admin controls on cards */
.admin-actions{
  display:flex;
  gap:10px;
  margin-top:12px;
  flex-wrap:wrap;
}

.admin-actions .admin-btn{
  padding:10px 12px;
  border-radius:10px;
  border:1px solid var(--border);
  background:var(--card);
  color:var(--text);
  font-weight:700;
  cursor:pointer;
  font-size:14px;
}

.admin-actions .admin-btn:hover{
  border-color:var(--accent);
}

.admin-actions .danger{
  border-color:rgba(255,0,0,0.25);
  color:#ff6b6b;
}

.admin-actions .danger:hover{
  border-color:#ff6b6b;
}

.admin-actions .success{
  border-color:rgba(16,185,129,0.35);
  color:#10b981;
}

.admin-actions .success:hover{
  border-color:#10b981;
}
/* <!----------------f-------> */
    .card h3{
      margin:0 0 10px;
      font-size:20px;
      color:var(--text);
      font-weight:700;
    }
    .price{
      font-weight:700;
      margin:8px 0;
      color:var(--accent);
      font-size:24px;
      letter-spacing:-0.5px;
    }
    .card p{
      margin:0;
      color:var(--muted);
      font-size:14px;
    }

    #contact{
      padding:60px 0;
      text-align:center;
    }
    #contact h2{
      color:var(--text);
      margin-bottom:16px;
      font-size:32px;
      font-weight:700;
    }
    #contact p{
      color:var(--muted);
      font-size:16px;
      margin-bottom:24px;
    }
    
    .contact-buttons{
      display:flex;
      gap:16px;
      max-width:600px;
      margin:0 auto;
      justify-content:center;
      flex-direction:column;
      padding:0 20px;
    }
    .contact-btn{
      display:inline-block;
      padding:18px 32px;
      background:linear-gradient(135deg,var(--accent),#2b8fff);
      color:#fff;
      text-align:center;
      text-decoration:none;
      font-weight:700;
      font-size:18px;
      border-radius:12px;
      transition:all 0.3s cubic-bezier(0.4,0,0.2,1);
      box-shadow:0 4px 15px rgba(11,110,255,0.3);
      width:100%;
      min-width:auto;
    }
    .contact-btn:hover{
      transform:translateY(-3px);
      box-shadow:0 8px 25px rgba(11,110,255,0.4);
    }
    .contact-btn.email{
      background:linear-gradient(135deg,#10b981,#059669);
      box-shadow:0 4px 15px rgba(16,185,129,0.3);
    }
    .contact-btn.email:hover{
      box-shadow:0 8px 25px rgba(16,185,129,0.4);
    }

    .contact-btn.secondary{
  background: var(--card);
  color: var(--accent);
  border: 2px solid var(--accent);
  box-shadow: var(--shadow);
}

.contact-btn.secondary:hover{
  background: var(--glass);
  transform: translateY(-3px);
}

    footer{
      text-align:center;
      padding:40px 0;
      color:var(--muted);
      border-top:1px solid var(--border);
      margin-top:60px;
      font-size:14px;
    }

    @media(max-width:768px){
      .header-inner{padding:12px 0 }
      nav{
        display:flex;
        flex-wrap:wrap;
        justify-content:center;
        gap:6px;
      }
      nav a{
        padding:8px 14px;
        font-size:14px;
      }
      .hero{padding:40px 0 30px}
      .hero h1{font-size:36px}
      .controls{flex-direction:column;padding:0 20px}
      .btn{width:100%;text-align:center}
      .sold-link{width:100%;text-align:center;margin-top:12px}
      .grid{grid-template-columns:1fr;gap:24px}
      .settings-modal{padding:24px}
      .contact-buttons{
        flex-direction:column;
        padding:0 20px;
      }
      .contact-btn{
        width:100%;
        min-width:auto;
      }
    }

    @media(max-width:480px){
      .logo{font-size:20px}
      .settings-toggle{padding:8px;width:40px;height:40px}
      .settings-icon{font-size:18px}
    }

    .car-card {
  /* normal styling */
}

.car-card.sold {
  opacity: 0.5;
}


.view-btn-active {
  background: linear-gradient(135deg, var(--accent), #2b8fff);
  color: #fff;
  border-color: transparent;
  box-shadow: 0 6px 18px rgba(11,110,255,0.35);
}

.view-btn-inactive {
  background: var(--card);
  color: var(--muted);
  border: 2px solid var(--border);
}

  </style>
</head>
<body>

<header>
  <div class="container header-inner">
    <div class="logo">PAB SHOP</div>
    <nav>
      <a href="#home">Home</a>
      <a href="#cars">Cars</a>
      <a href="#contact">Contact</a>
    </nav>
    <button id="settingsToggle" class="settings-toggle">
      <span class="settings-icon">‚öôÔ∏è</span>
    </button>
  </div>
</header>

<!-- Settings Modal -->
<div class="settings-overlay" id="settingsOverlay">
  <div class="settings-modal">
    <div class="settings-header">
      <h2>Settings</h2>
      <button class="close-btn" id="closeSettings">√ó</button>
    </div>

    <!-- Theme section -->
    <div class="settings-section">
      <h3>Theme Mode</h3>
      <div class="theme-buttons">
        <button class="theme-btn" data-theme="light">
          <span>‚òÄÔ∏è</span><span>Light</span>
        </button>
        <button class="theme-btn" data-theme="dark">
          <span>üåô</span><span>Dark</span>
        </button>
      </div>
    </div>
<!-- Owner login trigger (visible to everyone, opens login form) -->
<div class="settings-section" id="ownerLoginSection">
  <h3>Secret</h3>
  <button id="showOwnerLoginBtn" class="theme-btn" style="width:100%;">Secret</button>
</div>

    <!-- Admin section -->
    <div class="settings-section" id="adminSection" style="display:none;">
      <h3>Admin</h3>

      <div id="authLoggedOut" style="display:none;">
        <input id="adminEmail" type="email" placeholder="Owner email"
          style="width:100%; padding:12px; border-radius:10px; border:1px solid var(--border); margin-bottom:10px;">
        <input id="adminPassword" type="password" placeholder="Password"
          style="width:100%; padding:12px; border-radius:10px; border:1px solid var(--border); margin-bottom:10px;">
        <button id="loginBtn" class="theme-btn" style="width:100%;">Login</button>
      </div>

      <div id="authLoggedIn" style="display:none;">
        <p id="adminEmailLabel" style="color:var(--muted); margin-bottom:12px;"></p>
        <button id="logoutBtn" class="theme-btn" style="width:100%;">Logout</button>

        <div style="margin-top:14px;">
          <button id="viewUserBtn"
  class="theme-btn view-btn-inactive"
  style="width:100%;">
  User view
</button>

<button id="viewAdminBtn"
  class="theme-btn view-btn-inactive"
  style="width:100%; margin-top:10px;">
  Admin view
</button>
        </div>
      </div>
    </div>

  </div>
</div>

<section class="hero" id="home">
  <div class="container">
    <h1>Find your next car</h1>
    <p>Clean listings. Clear pricing. Direct contact.</p>
<div class="controls">
  <div class="search"><input id="q" placeholder="Search by make or model..."></div>
  <a class="btn" href="#cars">Browse Cars</a>

  <!-- ADMIN ONLY -->
  <a class="btn admin-only" id="addCarBtn" href="javascript:void(0)" style="display:none;">
    + Add Car
  </a>
</div>

    <a class="sold-link" href="sold.html">View Sold Cars ‚Üí</a>
  </div>
</section>

<section class="cars">
  <h2></h2>
<div id="car-list"></div>
</section>

<section id="cars" class="container">
  <div class="grid" id="grid">
<!------------------------------ SUPABASE ------------------------------->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
const SUPABASE_URL = "https://liipbpmjqjqxkuflufkv.supabase.co";
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxpaXBicG1qcWpxeGt1Zmx1Zmt2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU5MTg0MjYsImV4cCI6MjA4MTQ5NDQyNn0.LrIRgiVCE6E9vyXduQZEkdKAmmLDij2kQN2ajjavTS8";
const db = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);



  initAdminLink();

  db.auth.onAuthStateChange(() => {
    initAdminLink();
  });
</script>
<script>
async function loadCars() {
  const { data, error } = await db.from("cars").select("*");
  if (error) {
    console.error(error);
    return;
  }
  
  const container = document.getElementById("grid");
container.innerHTML = "";

  console.log("Rendered", data.length, "cars");
  
data.forEach(car => {
  const card = document.createElement("div");
  card.className = "card";
  card.setAttribute("data-title", (car.title || "").toLowerCase());

card.style.cursor = "pointer";

card.addEventListener("click", () => {
  window.location.href = `cars/cars.html?id=${car.id}`;
});

  if (car.status === "sold") {
    card.classList.add("sold");
  }



const showAdminControls = window.isAdmin && (localStorage.getItem("viewMode") !== "user");

card.innerHTML = `
  <div class="card-img-wrap">
    <img src="${car.cover_image}" alt="${car.title}">
  </div>
  <div class="card-body">
    <h3>${car.title}</h3>
    <div class="price">$${car.price}</div>
    <p>${car.mileage} mi ¬∑ ${car.history_status || "Clean history"}</p>

    ${showAdminControls ? `
      <div class="admin-actions admin-only">
        <button class="mini-btn sold-btn" data-action="toggle-sold"> ${car.status === "sold" ? "Unmark Sold" : "Mark Sold"} </button>
        <button class="mini-btn" data-action="edit">Edit</button>
        <button class="mini-btn danger" data-action="delete">Delete</button>
      </div>
    ` : ``}
  </div>
`;

if (showAdminControls) {
  // prevent clicking buttons from opening the car page
  card.querySelectorAll("button").forEach(btn => {
    btn.addEventListener("click", e => e.stopPropagation());
  });

  // Toggle Sold
  card.querySelector('[data-action="toggle-sold"]')?.addEventListener("click", async () => {
    const nextStatus = (car.status === "sold") ? "available" : "sold";
    if (!confirm(`Set status to "${nextStatus}"?`)) return;

    const { error } = await db.from("cars")
      .update({ status: nextStatus })
      .eq("id", car.id);

    if (error) { console.error(error); alert("Failed."); return; }
    location.reload();
  });

  // Delete
  card.querySelector('[data-action="delete"]')?.addEventListener("click", async () => {
    if (!confirm("Delete this car forever? (no undo)")) return;

    const { error } = await db.from("cars")
      .delete()
      .eq("id", car.id);

    if (error) { console.error(error); alert("Failed."); return; }
    location.reload();
  });

  // Edit (simple for now: jump to car detail page)
  card.querySelector('[data-action="edit"]')?.addEventListener("click", () => {
    window.location.href = `cars/cars.html?id=${car.id}`;
  });
}







// Admin button handlers (prevent card click)
if (window.isAdmin && (localStorage.getItem("viewMode") !== "user")) {
  card.querySelectorAll("[data-action]").forEach(btn => {
    btn.addEventListener("click", async (e) => {
      e.stopPropagation(); // IMPORTANT: prevents opening the car page

      const action = btn.dataset.action;

      if (action === "edit") {
        // For Phase 1, just jump to car page and reuse your edit button there later
        window.location.href = `cars/cars.html?id=${car.id}&edit=1`;
      }

      if (action === "sold") {
        const nextStatus = (car.status === "sold") ? "available" : "sold";
        const ok = confirm(`Set status to "${nextStatus}"?`);
        if (!ok) return;

        const { error } = await db.from("cars").update({ status: nextStatus }).eq("id", car.id);
        if (error) { console.error(error); alert("Failed to update."); return; }

        loadCars(); // refresh list
      }

      if (action === "delete") {
        const ok = confirm("Delete this car forever? (no undo)");
        if (!ok) return;

        const { error } = await db.from("cars").delete().eq("id", car.id);
        if (error) { console.error(error); alert("Failed to delete."); return; }

        loadCars(); // refresh list
      }
    });
  });
}


// Admin button logic (only does something in admin view)
const actions = card.querySelector(".admin-actions");

if (actions) {
  actions.addEventListener("click", async (e) => {
    const btn = e.target.closest("button[data-action]");
    if (!btn) return;

    e.stopPropagation(); // important: prevents card click opening the car page

    // If not admin OR in user view, ignore
    if (!window.isAdmin || (localStorage.getItem("viewMode") === "user")) return;

    const action = btn.dataset.action;

    if (action === "edit") {
      // Go to the car detail page, but in admin mode you‚Äôll edit there
      window.location.href = `cars/cars.html?id=${car.id}`;
      return;
    }

    if (action === "sold") {
      const nextStatus = (car.status === "sold") ? "available" : "sold";
      const ok = confirm(`Set status to "${nextStatus}"?`);
      if (!ok) return;

      const { error } = await db
        .from("cars")
        .update({ status: nextStatus })
        .eq("id", car.id);

      if (error) {
        console.error(error);
        alert("Failed to update status.");
        return;
      }

      // quick refresh
      location.reload();
      return;
    }

    if (action === "delete") {
      const ok = confirm("Delete this car forever? (no undo)");
      if (!ok) return;

      const { error } = await db
        .from("cars")
        .delete()
        .eq("id", car.id);

      if (error) {
        console.error(error);
        alert("Failed to delete.");
        return;
      }

      location.reload();
    }
  });
}




  container.insertBefore(card, container.firstChild);
});

applyAdminView();
}
loadCars();
</script>
<!------------------------------ END SUPABASE ------------------------------>
  </div>
</section>

<!---------------------Admin Start------------------------------------->
<script>

  function rerenderAllAdminUI() {
  // Update admin-only elements visibility
  applyAdminView();
  updateViewButtons();

  // Re-render cards because admin buttons are injected in loadCars()
  if (typeof loadCars === "function") loadCars();
}

  // Global flag used later for admin-only UI
  window.isAdmin = false;

  function $(id){ return document.getElementById(id); }

async function refreshAuthUI() {
  const { data: { session } } = await db.auth.getSession();
  window.isAdmin = !!session;

  const adminSection = $("adminSection");
  const ownerLoginSection = $("ownerLoginSection");

  const outBox = $("authLoggedOut");
  const inBox  = $("authLoggedIn");
  const emailLabel = $("adminEmailLabel");

  if (window.isAdmin) {
    if (adminSection) adminSection.style.display = "";
    if (ownerLoginSection) ownerLoginSection.style.display = "none";
  } else {
    // logged out: hide admin section until owner presses "Owner Login"
    if (adminSection) adminSection.style.display = "none";
    if (ownerLoginSection) ownerLoginSection.style.display = "";
  }

  if (outBox) outBox.style.display = window.isAdmin ? "none" : "";
  if (inBox)  inBox.style.display  = window.isAdmin ? "" : "none";

  if (emailLabel) {
    emailLabel.textContent = session?.user?.email ? `Logged in as: ${session.user.email}` : "";
  }

  rerenderAllAdminUI();
}


async function loginOwner() {
  const email = $("adminEmail")?.value?.trim();
  const password = $("adminPassword")?.value;

  if (!email || !password) return alert("Enter email + password.");

  const { error } = await db.auth.signInWithPassword({ email, password });
  if (error) return alert("Login failed.");

  await refreshAuthUI();
  rerenderAllAdminUI(); // ‚úÖ forces cards to re-render
}

async function logoutOwner() {
  const { error } = await db.auth.signOut();
  if (error) console.error(error);

  await refreshAuthUI();
  rerenderAllAdminUI(); // ‚úÖ removes admin buttons from cards
}


  // Wire buttons once DOM exists
  document.addEventListener("DOMContentLoaded", async () => {
    $("loginBtn")?.addEventListener("click", loginOwner);
    $("logoutBtn")?.addEventListener("click", logoutOwner);

    await refreshAuthUI();

    // Keep UI synced if session changes
    db.auth.onAuthStateChange(async () => {
  await refreshAuthUI();
  loadCars(); // re-render cards after auth change
});

$("showOwnerLoginBtn")?.addEventListener("click", () => {
  const adminSection = $("adminSection");
  const ownerLoginSection = $("ownerLoginSection");

  if (adminSection) adminSection.style.display = "";
  if (ownerLoginSection) ownerLoginSection.style.display = "none";

  // show login box (logged out)
  if ($("authLoggedOut")) $("authLoggedOut").style.display = "";
  if ($("authLoggedIn")) $("authLoggedIn").style.display = "none";
});




document.getElementById("addCarBtn")?.addEventListener("click", async () => {
  const isAdminEffective = window.isAdmin && (localStorage.getItem("viewMode") !== "user");
  if (!isAdminEffective) return;

  const title = prompt("Car title (example: 2019 BMW 330i)");
  if (!title) return;

  const priceStr = prompt("Price (numbers only)");
  const price = Number(priceStr);
  if (!Number.isFinite(price)) { alert("Invalid price"); return; }

  const mileageStr = prompt("Mileage (numbers only)");
  const mileage = Number(mileageStr);
  if (!Number.isFinite(mileage)) { alert("Invalid mileage"); return; }

  const cover_image = prompt("Cover image URL (for now)");
  if (!cover_image) { alert("Cover image required for now."); return; }

 const payload = {
  title,
  price,
  mileage,
  status: "available",
  cover_image,
  images: [cover_image],
  description: ""
};

const { data, error } = await db.from("cars").insert([payload]).select();

if (error) {
  console.error("INSERT ERROR:", error);
  alert("Add car failed: " + (error.message || "unknown error"));
  return;
}

console.log("Inserted:", data);


  loadCars();
});

  });








function setViewMode(mode) {
  localStorage.setItem("viewMode", mode);
  updateViewButtons();
  applyAdminView();
}

function getViewMode() {
  return localStorage.getItem("viewMode") || "admin";
}




function updateViewButtons() {
  const mode = getViewMode();
  const userBtn = document.getElementById("viewUserBtn");
  const adminBtn = document.getElementById("viewAdminBtn");

  if (!userBtn || !adminBtn) return;

  if (mode === "admin") {
    adminBtn.classList.add("view-btn-active");
    adminBtn.classList.remove("view-btn-inactive");

    userBtn.classList.add("view-btn-inactive");
    userBtn.classList.remove("view-btn-active");
  } else {
    userBtn.classList.add("view-btn-active");
    userBtn.classList.remove("view-btn-inactive");

    adminBtn.classList.add("view-btn-inactive");
    adminBtn.classList.remove("view-btn-active");
  }
}





document.getElementById("viewUserBtn")?.addEventListener("click", () => {
  setViewMode("user");
});

document.getElementById("viewAdminBtn")?.addEventListener("click", () => {
  setViewMode("admin");
});




function applyAdminView() {
  const mode = getViewMode(); // "admin" or "user"
  const adminEls = document.querySelectorAll(".admin-only");

  const canSeeAdmin = window.isAdmin && mode === "admin";

  adminEls.forEach(el => {
    el.style.display = canSeeAdmin ? "" : "none";
  });
}





updateViewButtons();
applyAdminView();

</script>
<!---------------------Admin End--------------------------------------->
<!-- ============================================================ -->
<!-- EDITABLE: CONTACT INFO -->
<!-- ============================================================ -->
<section id="contact" class="container">
  <h2>Contact Us</h2>
  <p>Contact us for more information</p> <!-- EDITABLE: Contact subtitle -->
  <div class="contact-buttons">
    <a href="tel:+15165657312" class="contact-btn">üìû Call: +1 (516) 565-7312</a> <!-- EDITABLE: Phone -->
    <a href="mailto:sales@pabshop.com" class="contact-btn email">‚úâÔ∏è Email Us</a> <!-- EDITABLE: Email -->
    <a href="tel:+15857347880" class="contact-btn secondary">üìû Call: +1 (585) 734-7880</a>
  </div>
</section>

<footer>
  <div class="container">
    <p>¬© 2025 PAB SHOP. All rights reserved.</p> <!-- EDITABLE: Footer text -->
  </div>
</footer>

<script>
  const root = document.documentElement;
  const settingsToggle = document.getElementById('settingsToggle');
  const settingsOverlay = document.getElementById('settingsOverlay');
  const closeSettings = document.getElementById('closeSettings');
  
  // Load saved theme
  const savedTheme = localStorage.getItem('theme') || 'dark';
  root.setAttribute('data-theme', savedTheme);
  
  // Update UI to reflect saved theme
  updateThemeButtons();
  
  // Open settings
  settingsToggle.onclick = () => {
    settingsOverlay.classList.add('active');
  };
  
  // Close settings
  closeSettings.onclick = () => {
    settingsOverlay.classList.remove('active');
  };
  
  // Close on overlay click
  settingsOverlay.onclick = (e) => {
    if (e.target === settingsOverlay) {
      settingsOverlay.classList.remove('active');
    }
  };
  
  // Theme buttons
document.querySelectorAll('.theme-btn[data-theme]').forEach(btn => {
  btn.onclick = () => {
    const theme = btn.dataset.theme;
    if (!theme) return;
    root.setAttribute('data-theme', theme);
    localStorage.setItem('theme', theme);
    updateThemeButtons();
  };
});

  
  function updateThemeButtons() {
    const currentTheme = root.getAttribute('data-theme');
    document.querySelectorAll('.theme-btn').forEach(btn => {
      btn.classList.toggle('active', btn.dataset.theme === currentTheme);
    });
  }

  // Search functionality - ONLY searches cards on THIS page
  document.getElementById('q').addEventListener('input', e => {
    const v = e.target.value.toLowerCase();
    const cardsOnPage = document.querySelectorAll('#grid .card');
    cardsOnPage.forEach(c => {
      c.style.display = c.dataset.title.includes(v) ? '' : 'none';
    });
  });
</script>

</body>
</html>