<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>2019 BMW 3 Series ‚Äî PAB SHOP</title>
  <meta name="description" content="2019 BMW 3 Series for sale - $28,500">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    /* EXACT COPY FROM HOMEPAGE */
    :root{
      --bg:#f6f7fb;
      --card:#ffffff;
      --muted:#6b7280;
      --text:#0f1724;
      --accent:#0b6eff;
      --glass:rgba(255,255,255,0.65);
      --shadow:0 6px 20px rgba(12,15,20,0.06);
      --border:rgba(0,0,0,0.04);
      .contact-buttons{
        flex-direction:column;
        padding:0 0;
      }
      .contact-btn{
        width:100%;
        min-width:auto;
      }
    }
    [data-theme="dark"]{
      --bg:#0b0f16;
      --card:#0f1724;
      --muted:#94a3b8;
      --text:#e6eef8;
      --accent:#4ea8ff;
      --glass:rgba(255,255,255,0.05);
      --shadow:0 10px 30px rgba(0,0,0,0.6);
      --border:rgba(255,255,255,0.03);
    }
    
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family:Inter,system-ui;
      background:var(--bg);
      color:var(--text);
      transition:background 0.4s ease, color 0.4s ease;
      line-height:1.6;
    }
    .container{max-width:1200px;margin:0 auto;padding:0 20px}

    /* EXACT COPY FROM HOMEPAGE */
    header .container{
      padding:10px 20px;
    }

    header{
      position:sticky;
      top:0;
      z-index:100;
      backdrop-filter:blur(12px) saturate(180%);
      background:var(--glass);
      border-bottom:1px solid var(--border);
      transition:all 0.4s ease;
    }
    .header-inner{
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:16px 0;
    }
    .logo{
      font-weight:700;
      color:var(--accent);
      font-size:22px;
      letter-spacing:-0.5px;
      text-decoration:none;
    }
    nav{display:flex;gap:8px;align-items:center}
    nav a{
      padding:10px 16px;
      color:var(--muted);
      text-decoration:none;
      font-weight:600;
      border-radius:8px;
      transition:all 0.3s cubic-bezier(0.4,0,0.2,1);
      font-size:15px;
    }
    nav a:hover{
      color:var(--text);
      background:var(--glass);
      transform:translateY(-1px);
    }

    /* EXACT COPY FROM HOMEPAGE - Settings Toggle */
    .settings-toggle{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:50%;
      padding:10px;
      width:44px;
      height:44px;
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
      color:var(--text);
      transition:all 0.3s cubic-bezier(0.4,0,0.2,1);
      box-shadow:var(--shadow);
    }
    .settings-toggle:hover{
      transform:scale(1.08);
      box-shadow:0 8px 25px rgba(0,0,0,0.1);
    }
    .settings-toggle:active{transform:scale(0.98)}
    .settings-icon{font-size:20px;transition:transform 0.6s ease}
    .settings-toggle:hover .settings-icon{transform:rotate(90deg)}

    /* EXACT COPY FROM HOMEPAGE - Settings Modal */
    .settings-overlay{
      position:fixed;
      top:0;
      left:0;
      width:100%;
      height:100%;
      background:rgba(0,0,0,0.5);
      backdrop-filter:blur(4px);
      z-index:1000;
      display:flex;
      align-items:center;
      justify-content:center;
      opacity:0;
      pointer-events:none;
      transition:opacity 0.3s ease;
    }
    .settings-overlay.active{
      opacity:1;
      pointer-events:all;
    }
    
    .settings-modal{
      background:var(--card);
      border-radius:20px;
      padding:32px;
      box-shadow:0 20px 60px rgba(0,0,0,0.3);
      border:1px solid var(--border);
      max-width:500px;
      width:90%;
      transform:scale(0.8) translateY(-20px);
      transition:transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    .settings-overlay.active .settings-modal{
      transform:scale(1) translateY(0);
    }
    
    .settings-header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:28px;
    }
    .settings-header h2{
      font-size:26px;
      color:var(--text);
      font-weight:700;
    }
    .close-btn{
      background:none;
      border:none;
      font-size:28px;
      color:var(--muted);
      cursor:pointer;
      transition:all 0.2s ease;
      width:36px;
      height:36px;
      display:flex;
      align-items:center;
      justify-content:center;
      border-radius:8px;
    }
    .close-btn:hover{
      background:var(--glass);
      color:var(--text);
      transform:rotate(90deg);
    }
    
    .settings-section{
      margin-bottom:28px;
    }
    .settings-section:last-child{
      margin-bottom:0;
    }
    .settings-section h3{
      font-size:16px;
      color:var(--text);
      margin-bottom:14px;
      font-weight:700;
      text-transform:uppercase;
      letter-spacing:0.5px;
      opacity:0.8;
    }
    
    .theme-buttons{
      display:flex;
      gap:12px;
    }
    .theme-btn{
      flex:1;
      padding:16px;
      border:2px solid var(--border);
      border-radius:12px;
      background:var(--card);
      cursor:pointer;
      transition:all 0.3s ease;
      font-weight:600;
      font-size:15px;
      color:var(--text);
      display:flex;
      align-items:center;
      justify-content:center;
      gap:8px;
    }
    .theme-btn:hover{
      transform:translateY(-2px);
      box-shadow:0 8px 20px rgba(0,0,0,0.1);
    }
    .theme-btn.active{
      border-color:var(--accent);
      background:var(--accent);
      color:#fff;
    }

    .back-link{
      display:inline-flex;
      align-items:center;
      gap:8px;
      color:var(--muted);
      text-decoration:none;
      font-weight:600;
      margin:30px 0 20px;
      transition:all 0.3s ease;
      font-size:15px;
    }
    .back-link:hover{
      color:var(--accent);
      transform:translateX(-4px);
    }

    .car-detail{
      padding:20px 0 60px;
    }
    
    .car-header{
      margin-bottom:40px;
    }
    .car-header h1{
      font-size:clamp(32px,5vw,48px);
      margin:0 0 16px;
      font-weight:700;
      letter-spacing:-1px;
    }
    .car-price{
      font-size:36px;
      color:var(--accent);
      font-weight:700;
      margin-bottom:8px;
    }
    .car-meta{
      color:var(--muted);
      font-size:18px;
    }

    .content-grid{
      display:grid;
      grid-template-columns:2fr 1fr;
      gap:40px;
      margin-bottom:60px;
    }

    .gallery{
      background:var(--card);
      border-radius:16px;
      overflow:hidden;
      box-shadow:var(--shadow);
      border:1px solid var(--border);
      position:relative;
    }
    .main-img{
      width:100%;
      height:500px;
      object-fit:contain;
      background:var(--bg);
      cursor:pointer;
      transition:transform 0.3s ease;
    }
    
    .slider-btn{
      position:absolute;
      top:50%;
      transform:translateY(-50%);
      background:rgba(255,255,255,0.9);
      border:none;
      width:50px;
      height:50px;
      border-radius:50%;
      cursor:pointer;
      font-size:24px;
      display:none;
      align-items:center;
      justify-content:center;
      transition:all 0.3s ease;
      box-shadow:0 4px 12px rgba(0,0,0,0.15);
      z-index:10;
    }
    .slider-btn:hover{
      background:rgba(255,255,255,1);
      transform:translateY(-50%) scale(1.1);
    }
    .slider-btn:active{
      transform:translateY(-50%) scale(0.95);
    }
    .slider-btn.prev{left:15px}
    .slider-btn.next{right:15px}
    [data-theme="dark"] .slider-btn{
      background:rgba(255,255,255,0.15);
      color:#fff;
    }
    [data-theme="dark"] .slider-btn:hover{
      background:rgba(255,255,255,0.25);
    }
    
    .slider-dots{
      position:absolute;
      top:50%;
      transform:translateY(-50%);
      right:20px;
      display:none;
      flex-direction:column;
      gap:8px;
      z-index:10;
    }
    .dot{
      width:10px;
      height:10px;
      border-radius:50%;
      background:rgba(255,255,255,0.5);
      cursor:pointer;
      transition:all 0.3s ease;
    }
    .dot.active{
      background:rgba(255,255,255,1);
      height:24px;
      border-radius:5px;
    }
    
    /* Fullscreen modal */
    .fullscreen-overlay{
      position:fixed;
      top:0;
      left:0;
      width:100%;
      height:100%;
      background:rgba(0,0,0,0.95);
      z-index:2000;
      display:none;
      align-items:center;
      justify-content:center;
      opacity:0;
      transition:opacity 0.3s ease;
    }
    .fullscreen-overlay.active{
      display:flex;
      opacity:1;
    }
    .fullscreen-img{
      max-width:90%;
      max-height:90%;
      object-fit:contain;
    }
    .fullscreen-close{
      position:absolute;
      top:20px;
      right:30px;
      font-size:40px;
      color:#fff;
      cursor:pointer;
      background:rgba(0,0,0,0.5);
      width:50px;
      height:50px;
      border-radius:50%;
      display:flex;
      align-items:center;
      justify-content:center;
      transition:all 0.3s ease;
      border:2px solid rgba(255,255,255,0.3);
      z-index:2001;
    }
    .fullscreen-close:hover{
      background:rgba(0,0,0,0.8);
      transform:rotate(90deg);
    }
    .fullscreen-nav{
      position:absolute;
      top:50%;
      transform:translateY(-50%);
      background:linear-gradient(135deg,var(--accent),#2b8fff);
      border:none;
      width:60px;
      height:60px;
      border-radius:50%;
      cursor:pointer;
      font-size:30px;
      display:flex;
      align-items:center;
      justify-content:center;
      transition:all 0.3s ease;
      box-shadow:0 4px 15px rgba(11,110,255,0.5);
      z-index:2001;
      color:#fff;
    }
    .fullscreen-nav:hover{
      transform:translateY(-50%) scale(1.15);
      box-shadow:0 8px 25px rgba(11,110,255,0.7);
    }
    .fullscreen-nav:active{
      transform:translateY(-50%) scale(1.05);
    }
    .fullscreen-nav.prev{left:30px}
    .fullscreen-nav.next{right:30px}
    .fullscreen-counter{
      position:absolute;
      bottom:30px;
      left:50%;
      transform:translateX(-50%);
      background:linear-gradient(135deg,var(--accent),#2b8fff);
      color:#fff;
      padding:12px 28px;
      border-radius:25px;
      font-size:16px;
      font-weight:700;
      z-index:2001;
      box-shadow:0 4px 15px rgba(11,110,255,0.5);
      letter-spacing:1px;
    }
    
    .thumbs{
      display:grid;
      grid-template-columns:repeat(4,1fr);
      gap:12px;
      padding:20px;
      background:var(--bg);
    }
    .thumb{
      aspect-ratio:4/3;
      border-radius:8px;
      overflow:hidden;
      cursor:pointer;
      border:3px solid transparent;
      transition:all 0.3s ease;
    }
    .thumb:hover{
      border-color:var(--accent);
      transform:scale(1.05);
    }
    .thumb.active{
      border-color:var(--accent);
    }
    .thumb img{
      width:100%;
      height:100%;
      object-fit:cover;
    }

    .sidebar{
      display:flex;
      flex-direction:column;
      gap:24px;
    }

    .info-card{
      background:var(--card);
      border-radius:16px;
      padding:28px;
      box-shadow:var(--shadow);
      border:1px solid var(--border);
    }
    .info-card h3{
      margin:0 0 20px;
      font-size:20px;
      font-weight:700;
    }
    .spec-list{
      display:flex;
      flex-direction:column;
      gap:16px;
    }
    .spec-item{
      display:flex;
      justify-content:space-between;
      padding-bottom:12px;
      border-bottom:1px solid var(--border);
      align-items:center;
    }
    .spec-item:last-child{
      border:0;
      padding-bottom:0;
    }
    .spec-label{
      color:var(--muted);
      font-size:15px;
      display:flex;
      align-items:center;
      gap:10px;
    }
    .spec-icon{
      font-size:18px;
      color:var(--accent);
      width:24px;
      text-align:center;
      opacity:0.9;
    }
    .spec-value{
      font-weight:600;
      text-align:right;
    }

    .contact-card{
      background:linear-gradient(135deg,var(--accent),#2b8fff);
      color:#fff;
      text-align:center;
    }
    .contact-card h3{
      color:#fff;
    }
    .contact-card p{
      margin:16px 0 24px;
      opacity:0.95;
      font-size:15px;
    }
    .contact-btn{
      display:block;
      width:100%;
      padding:18px;
      background:#fff;
      color:var(--accent);
      text-align:center;
      text-decoration:none;
      font-weight:700;
      font-size:18px;
      border-radius:12px;
      transition:all 0.3s cubic-bezier(0.4,0,0.2,1);
      box-shadow:0 4px 15px rgba(0,0,0,0.2);
      margin-bottom:12px;
    }
    .contact-btn:hover{
      transform:translateY(-3px);
      box-shadow:0 8px 25px rgba(0,0,0,0.3);
    }
    .contact-btn:last-child{
      margin-bottom:0;
    }
    .contact-btn.email{
      background:linear-gradient(135deg,#10b981,#059669);
      color:#fff;
      box-shadow:0 4px 15px rgba(16,185,129,0.3);
    }
    .contact-btn.email:hover{
      box-shadow:0 8px 25px rgba(16,185,129,0.4);
    }

    .contact-btn.secondary{
  background: var(--card);
  color: var(--accent);
  border: 2px solid var(--accent);
  box-shadow: var(--shadow);
}

.contact-btn.secondary:hover{
  background: var(--glass);
  transform: translateY(-3px);
}

    .description{
      background:var(--card);
      border-radius:16px;
      padding:32px;
      box-shadow:var(--shadow);
      border:1px solid var(--border);
      margin-bottom:40px;
    }
    .description h2{
      margin:0 0 20px;
      font-size:28px;
      font-weight:700;
    }
    .description p{
      color:var(--muted);
      font-size:16px;
      line-height:1.8;
      margin-bottom:16px;
    }
    .description ul{
      margin:20px 0;
      padding-left:20px;
    }
    .description li{
      color:var(--muted);
      margin-bottom:10px;
      line-height:1.8;
    }

    #contact{
      padding:60px 0;
      text-align:center;
    }
    #contact h2{
      color:var(--text);
      margin-bottom:16px;
      font-size:32px;
      font-weight:700;
    }
    #contact p{
      color:var(--muted);
      font-size:16px;
      margin-bottom:24px;
    }
    
    .contact-buttons{
      display:flex;
      gap:16px;
      max-width:600px;
      margin:0 auto;
      justify-content:center;
      flex-direction:column;
      padding:0 20px;
    }
    .contact-btn{
      display:inline-block;
      padding:18px 32px;
      background:linear-gradient(135deg,var(--accent),#2b8fff);
      color:#fff;
      text-align:center;
      text-decoration:none;
      font-weight:700;
      font-size:18px;
      border-radius:12px;
      transition:all 0.3s cubic-bezier(0.4,0,0.2,1);
      box-shadow:0 4px 15px rgba(11,110,255,0.3);
      width:100%;
      min-width:auto;
    }
    .contact-btn:hover{
      transform:translateY(-3px);
      box-shadow:0 8px 25px rgba(11,110,255,0.4);
    }
    .contact-btn.email{
      background:linear-gradient(135deg,#10b981,#059669);
      box-shadow:0 4px 15px rgba(16,185,129,0.3);
    }
    .contact-btn.email:hover{
      box-shadow:0 8px 25px rgba(16,185,129,0.4);
    }

    footer{
      text-align:center;
      padding:40px 0;
      color:var(--muted);
      border-top:1px solid var(--border);
      margin-top:60px;
      font-size:14px;
    }

    @media(max-width:968px){
      .content-grid{
        grid-template-columns:1fr;
      }
      .main-img{
        height:400px;
      }
    }

    /* EXACT COPY FROM HOMEPAGE */
    @media(max-width:768px){
      .header-inner{padding:12px 0}
      nav{
        display:flex;
        flex-wrap:wrap;
        justify-content:center;
        gap:6px;
      }
      nav a{
        padding:8px 14px;
        font-size:14px;
      }
      .car-price{font-size:28px}
      .main-img{height:350px}
      .thumbs{
        grid-template-columns:repeat(3,1fr);
        gap:8px;
        padding:12px;
      }
      .description{
        padding:24px;
      }
      .settings-modal{padding:24px}
      .slider-dots{
        right:10px;
      }
    }

    /* EXACT COPY FROM HOMEPAGE */
    @media(max-width:480px){
      .logo{font-size:20px}
      .settings-toggle{padding:8px;width:40px;height:40px}
      .settings-icon{font-size:18px}
      .slider-btn{width:40px;height:40px;font-size:20px}
      .slider-btn.prev{left:10px}
      .slider-btn.next{right:10px}
      .main-img{height:300px}
      .thumbs{
        grid-template-columns:repeat(2,1fr);
      }
      .fullscreen-nav{
        width:45px;
        height:45px;
        font-size:24px;
      }
      .fullscreen-nav.prev{left:15px}
      .fullscreen-nav.next{right:15px}
      .fullscreen-counter{
        font-size:14px;
        padding:10px 20px;
        bottom:20px;
      }
    }


    .view-btn-active {
  background: linear-gradient(135deg, var(--accent), #2b8fff);
  color: #fff;
  border-color: transparent;
  box-shadow: 0 6px 18px rgba(11,110,255,0.35);
}

.view-btn-inactive {
  background: var(--card);
  color: var(--muted);
  border: 2px solid var(--border);
}

  </style>
</head>
<body>

<!-- EXACT COPY FROM HOMEPAGE -->
<header>
  <div class="container header-inner">
    <a href="../index.html" class="logo">PAB SHOP</a>
    <nav>
      <a href="../index.html#home">Home</a>
      <a href="../index.html#cars">Cars</a>
      <a href="../index.html#contact">Contact</a>
    </nav>
    <button id="settingsToggle" class="settings-toggle">
      <span class="settings-icon">‚öôÔ∏è</span>
    </button>
  </div>
</header>

<!-- Settings Modal -->
<div class="settings-overlay" id="settingsOverlay">
  <div class="settings-modal">
    <div class="settings-header">
      <h2>Settings</h2>
      <button class="close-btn" id="closeSettings">√ó</button>
    </div>

    <!-- Theme section -->
    <div class="settings-section">
      <h3>Theme Mode</h3>
      <div class="theme-buttons">
        <button class="theme-btn" data-theme="light">
          <span>‚òÄÔ∏è</span><span>Light</span>
        </button>
        <button class="theme-btn" data-theme="dark">
          <span>üåô</span><span>Dark</span>
        </button>
      </div>
    </div>

    <!-- Owner login trigger (visible to everyone, opens login form) -->
<div class="settings-section" id="ownerLoginSection">
  <h3>Secret</h3>
  <button id="showOwnerLoginBtn" class="theme-btn" style="width:100%;">Secret</button>
</div>

    <!-- Admin section -->
    <div class="settings-section" id="adminSection" style="display:none;">
      <h3>Admin</h3>

      <div id="authLoggedOut" style="display:none;">
        <input id="adminEmail" type="email" placeholder="Owner email"
          style="width:100%; padding:12px; border-radius:10px; border:1px solid var(--border); margin-bottom:10px;">
        <input id="adminPassword" type="password" placeholder="Password"
          style="width:100%; padding:12px; border-radius:10px; border:1px solid var(--border); margin-bottom:10px;">
        <button id="loginBtn" class="theme-btn" style="width:100%;">Login</button>
      </div>

      <div id="authLoggedIn" style="display:none;">
        <p id="adminEmailLabel" style="color:var(--muted); margin-bottom:12px;"></p>
        <button id="logoutBtn" class="theme-btn" style="width:100%;">Logout</button>

        <div style="margin-top:14px;">
                    <button id="viewUserBtn"
  class="theme-btn view-btn-inactive"
  style="width:100%;">
  User view
</button>

<button id="viewAdminBtn"
  class="theme-btn view-btn-inactive"
  style="width:100%; margin-top:10px;">
  Admin view
</button>
        </div>
      </div>
    </div>

  </div>
</div>

<div class="container">
  <a href="../index.html#cars" class="back-link">‚Üê Back to all cars</a>

  <section class="car-detail">
    <!-- ============================================================ -->
    <!-- EDITABLE: Car Header -->
    <!-- ============================================================ -->
    <div class="car-header">
      <h1>Loading...</h1>
      <div class="car-price">Loading...</div>
      <div class="car-meta">Loading...</div>
    </div>

    <div class="content-grid">
      <!-- Gallery Section with slider -->
      <div class="gallery">
        <img id="mainImg" class="main-img" src="https://images.unsplash.com/photo-1555215695-3004980ad54e?w=800&h=600&fit=crop" alt="Main car image">
        
        <button class="slider-btn prev" onclick="changeSlide(-1)">‚Äπ</button>
        <button class="slider-btn next" onclick="changeSlide(1)">‚Ä∫</button>
        
        <div class="slider-dots" id="sliderDots"></div>
        
        <div class="thumbs">
          <!-- BMW 3 Series images -->
          <div class="thumb active" data-img="https://images.unsplash.com/photo-1555215695-3004980ad54e?w=800&h=600&fit=crop">
            <img src="https://images.unsplash.com/photo-1555215695-3004980ad54e?w=300&h=200&fit=crop" alt="Front view">
          </div>
        </div>
      </div>

      <!-- Sidebar -->
      <div class="sidebar">
        <!-- ============================================================ -->
        <!-- EDITABLE: Specifications -->
        <!-- ============================================================ -->
        <div class="info-card">
          <h3>Specifications</h3>
          <div class="spec-list">
            <div class="spec-item">
              <span class="spec-label"><i class="fas fa-calendar-alt spec-icon"></i>Year</span>
              <span class="spec-value">Loading...</span>
            </div>
            <div class="spec-item">
              <span class="spec-label"><i class="fas fa-car spec-icon"></i>Make</span>
              <span class="spec-value">Loading...</span>
            </div>
            <div class="spec-item">
              <span class="spec-label"><i class="fas fa-tag spec-icon"></i>Model</span>
              <span class="spec-value">Loading...</span>
            </div>
            <div class="spec-item">
              <span class="spec-label"><i class="fas fa-tachometer-alt spec-icon"></i>Mileage</span>
              <span class="spec-value">Loading...</span>
            </div>
            <div class="spec-item">
              <span class="spec-label"><i class="fas fa-cogs spec-icon"></i>Engine</span>
              <span class="spec-value">Loading...</span>
            </div>
            <div class="spec-item">
              <span class="spec-label"><i class="fas fa-cog spec-icon"></i>Transmission</span>
              <span class="spec-value">Loading...</span>
            </div>
            <div class="spec-item">
              <span class="spec-label"><i class="fas fa-road spec-icon"></i>Drivetrain</span>
              <span class="spec-value">Loading...</span>
            </div>
            <div class="spec-item">
              <span class="spec-label"><i class="fas fa-palette spec-icon"></i>Exterior</span>
              <span class="spec-value">Loading...</span>
            </div>
            <div class="spec-item">
              <span class="spec-label"><i class="fas fa-couch spec-icon"></i>Interior</span>
              <span class="spec-value">Loading...</span>
            </div>
            <div class="spec-item">
              <span class="spec-label"><i class="fas fa-barcode spec-icon"></i>VIN</span>
              <span class="spec-value">Loading...</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ============================================================ -->
    <!-- EDITABLE: Description -->
    <!-- ============================================================ -->
<!-- ADMIN ONLY ACTIONS -->
<div class="info-card admin-only" id="carAdminActions" style="display:none;">
  <h3>Admin Actions</h3>
  <div style="display:flex; gap:10px; flex-wrap:wrap;">
    <button class="theme-btn" id="editCarBtn" style="flex:1;">Edit Fields</button>
    <button class="theme-btn" id="toggleSoldBtn" style="flex:1;">Mark Sold</button>
    <button class="theme-btn" id="deleteCarBtn" style="flex:1;">Delete</button>
  </div>
</div>
<!-- ADMIN ONLY: IMAGE UPLOAD -->
<div class="info-card admin-only" id="carUploadBox" style="display:none;">
  <h3>Upload Photos</h3>

  <input id="photoInput" type="file" accept="image/*" multiple
    style="width:100%; padding:12px; border-radius:10px; border:1px solid var(--border); margin-bottom:12px;">

  <button class="theme-btn" id="uploadPhotosBtn" style="width:100%;">Upload Selected Photos</button>

  <p id="uploadStatus" style="color:var(--muted); margin-top:12px;"></p>
</div>

    <div class="description">
  <h2>About This Car</h2>
  <p id="carDescription">Loading...</p>
</div>


  </section>

  <!-- ============================================================ -->
  <!-- CONTACT SECTION - EXACT COPY FROM INDEX.HTML -->
  <!-- ============================================================ -->
  <section id="contact" class="container">
    <h2>Contact Us</h2>
    <p>Contact us for more information</p>
    <div class="contact-buttons">
      <a href="tel:+15165657312" class="contact-btn">üìû Call: +1 (516) 565-7312</a>
      <a href="mailto:sales@pabshop.com" class="contact-btn email">‚úâÔ∏è Email Us</a>
      <a href="tel:+15857347880" class="contact-btn secondary">üìû Call: +1 (585) 734-7880</a>
    </div>
  </section>
</div>

<!-- Fullscreen Image Viewer -->
<div class="fullscreen-overlay" id="fullscreenOverlay">
  <span class="fullscreen-close" id="fullscreenClose">√ó</span>
  <button class="fullscreen-nav prev" id="fullscreenPrev">‚Äπ</button>
  <button class="fullscreen-nav next" id="fullscreenNext">‚Ä∫</button>
  <div class="fullscreen-counter" id="fullscreenCounter">1 / 10</div>
  <img id="fullscreenImg" class="fullscreen-img" src="" alt="Fullscreen view">
</div>

<footer>
  <div class="container">
    <p>¬© 2025 PAB SHOP. All rights reserved.</p>
  </div>
</footer>

<script>
  // EXACT COPY FROM HOMEPAGE - Settings functionality
  const root = document.documentElement;
  const settingsToggle = document.getElementById('settingsToggle');
  const settingsOverlay = document.getElementById('settingsOverlay');
  const closeSettings = document.getElementById('closeSettings');
  
  // Load saved theme
  const savedTheme = localStorage.getItem('theme') || 'dark';
  root.setAttribute('data-theme', savedTheme);
  
  // Update UI to reflect saved theme
  updateThemeButtons();
  
  // Open settings
  settingsToggle.onclick = () => {
    settingsOverlay.classList.add('active');
  };
  
  // Close settings
  closeSettings.onclick = () => {
    settingsOverlay.classList.remove('active');
  };
  
  // Close on overlay click
  settingsOverlay.onclick = (e) => {
    if (e.target === settingsOverlay) {
      settingsOverlay.classList.remove('active');
    }
  };
  
  // Theme buttons
  document.querySelectorAll('.theme-btn[data-theme]').forEach(btn => {
  btn.onclick = () => {
    const theme = btn.dataset.theme;
    if (!theme) return;
    root.setAttribute('data-theme', theme);
    localStorage.setItem('theme', theme);
    updateThemeButtons();
  };
});
  
  function updateThemeButtons() {
    const currentTheme = root.getAttribute('data-theme');
    document.querySelectorAll('.theme-btn').forEach(btn => {
      btn.classList.toggle('active', btn.dataset.theme === currentTheme);
    });
  }

  // Image slider functionality
  const mainImg=document.getElementById('mainImg');
 const thumbs=document.querySelectorAll('.thumb');
const images = Array.from(thumbs).map(t => t.dataset.img);

  let currentIndex = 0;

  // Create dots
  const dotsContainer = document.getElementById('sliderDots');
  images.forEach((_, index) => {
    const dot = document.createElement('div');
    dot.className = 'dot' + (index === 0 ? ' active' : '');
    dot.onclick = () => goToSlide(index);
    dotsContainer.appendChild(dot);
  });

  function updateDots() {
    document.querySelectorAll('.dot').forEach((dot, index) => {
      dot.className = 'dot' + (index === currentIndex ? ' active' : '');
    });
    thumbs.forEach((thumb, index) => {
      thumb.className = 'thumb' + (index === currentIndex ? ' active' : '');
    });
  }

  function changeSlide(direction) {
    currentIndex += direction;
    if (currentIndex < 0) currentIndex = images.length - 1;
    if (currentIndex >= images.length) currentIndex = 0;
    mainImg.src = images[currentIndex];
    updateDots();
  }

  function goToSlide(index) {
    currentIndex = index;
    mainImg.src = images[currentIndex];
    updateDots();
  }

  // Thumbnail clicks
  thumbs.forEach((thumb, index) => {
    thumb.addEventListener('click', () => {
      currentIndex = index;
      mainImg.src = thumb.dataset.img;
      updateDots();
    });
  });

  // Click main image to open fullscreen
  mainImg.addEventListener('click', () => {
    fullscreenIndex = currentIndex;
    document.getElementById('fullscreenImg').src = images[fullscreenIndex];
    document.getElementById('fullscreenCounter').textContent = `${fullscreenIndex + 1} / ${images.length}`;
    document.getElementById('fullscreenOverlay').classList.add('active');
  });

  // Fullscreen navigation
  let fullscreenIndex = 0;

  document.getElementById('fullscreenPrev').addEventListener('click', (e) => {
    e.stopPropagation();
    fullscreenIndex--;
    if (fullscreenIndex < 0) fullscreenIndex = images.length - 1;
    document.getElementById('fullscreenImg').src = images[fullscreenIndex];
    document.getElementById('fullscreenCounter').textContent = `${fullscreenIndex + 1} / ${images.length}`;
  });

  document.getElementById('fullscreenNext').addEventListener('click', (e) => {
    e.stopPropagation();
    fullscreenIndex++;
    if (fullscreenIndex >= images.length) fullscreenIndex = 0;
    document.getElementById('fullscreenImg').src = images[fullscreenIndex];
    document.getElementById('fullscreenCounter').textContent = `${fullscreenIndex + 1} / ${images.length}`;
  });

  // Close fullscreen
  document.getElementById('fullscreenClose').addEventListener('click', (e) => {
    e.stopPropagation();
    document.getElementById('fullscreenOverlay').classList.remove('active');
  });

  // Close fullscreen on overlay click
  document.getElementById('fullscreenOverlay').addEventListener('click', (e) => {
    if (e.target === document.getElementById('fullscreenOverlay')) {
      document.getElementById('fullscreenOverlay').classList.remove('active');
    }
  });

  // Keyboard navigation in fullscreen
  document.addEventListener('keydown', (e) => {
    if (document.getElementById('fullscreenOverlay').classList.contains('active')) {
      if (e.key === 'ArrowLeft') {
        fullscreenIndex--;
        if (fullscreenIndex < 0) fullscreenIndex = images.length - 1;
        document.getElementById('fullscreenImg').src = images[fullscreenIndex];
        document.getElementById('fullscreenCounter').textContent = `${fullscreenIndex + 1} / ${images.length}`;
      }
      if (e.key === 'ArrowRight') {
        fullscreenIndex++;
        if (fullscreenIndex >= images.length) fullscreenIndex = 0;
        document.getElementById('fullscreenImg').src = images[fullscreenIndex];
        document.getElementById('fullscreenCounter').textContent = `${fullscreenIndex + 1} / ${images.length}`;
      }
      if (e.key === 'Escape') {
        document.getElementById('fullscreenOverlay').classList.remove('active');
      }
    }
  });

  // Fullscreen swipe support
  let fullscreenTouchStartX = 0;
  let fullscreenTouchEndX = 0;
  const fullscreenOverlay = document.getElementById('fullscreenOverlay');

  fullscreenOverlay.addEventListener('touchstart', e => {
    fullscreenTouchStartX = e.changedTouches[0].screenX;
  });

  fullscreenOverlay.addEventListener('touchend', e => {
    fullscreenTouchEndX = e.changedTouches[0].screenX;
    handleFullscreenSwipe();
  });

  function handleFullscreenSwipe() {
    if (fullscreenTouchEndX < fullscreenTouchStartX - 50) {
      // Swipe left - next image
      fullscreenIndex++;
      if (fullscreenIndex >= images.length) fullscreenIndex = 0;
      document.getElementById('fullscreenImg').src = images[fullscreenIndex];
      document.getElementById('fullscreenCounter').textContent = `${fullscreenIndex + 1} / ${images.length}`;
    }
    if (fullscreenTouchEndX > fullscreenTouchStartX + 50) {
      // Swipe right - previous image
      fullscreenIndex--;
      if (fullscreenIndex < 0) fullscreenIndex = images.length - 1;
      document.getElementById('fullscreenImg').src = images[fullscreenIndex];
      document.getElementById('fullscreenCounter').textContent = `${fullscreenIndex + 1} / ${images.length}`;
    }
  }

  // Touch swipe support
  let touchStartX = 0;
  let touchEndX = 0;
  const gallery = document.querySelector('.gallery');

  gallery.addEventListener('touchstart', e => {
    touchStartX = e.changedTouches[0].screenX;
  });

  gallery.addEventListener('touchend', e => {
    touchEndX = e.changedTouches[0].screenX;
    handleSwipe();
  });

  function handleSwipe() {
    if (touchEndX < touchStartX - 50) changeSlide(1);
    if (touchEndX > touchStartX + 50) changeSlide(-1);
  }
</script>

<!-------------------GPT------------------>
<script src="https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>
  const SUPABASE_URL = "https://liipbpmjqjqxkuflufkv.supabase.co";
  const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxpaXBicG1qcWpxeGt1Zmx1Zmt2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU5MTg0MjYsImV4cCI6MjA4MTQ5NDQyNn0.LrIRgiVCE6E9vyXduQZEkdKAmmLDij2kQN2ajjavTS8";
  const db = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

  // =========================
// PHASE 2: UPLOAD HELPERS
// =========================
async function compressImage(file) {
  const options = {
    maxSizeMB: 0.45,
    maxWidthOrHeight: 1920,
    useWebWorker: true
  };
  return await imageCompression(file, options);
}

function getPublicUrl(path) {
  const { data } = db.storage.from("cars").getPublicUrl(path);
  return data.publicUrl;
}

async function uploadPhotosForCar(carId, files) {
  const uploadedUrls = [];

  for (const file of files) {
    const compressed = await compressImage(file);
    const safeName = (compressed.name || "photo.jpg").replace(/\s+/g, "_");
    const path = `${carId}/${Date.now()}_${safeName}`;

    const { error } = await db.storage
      .from("cars")
      .upload(path, compressed, {
        cacheControl: "3600",
        upsert: false,
        contentType: compressed.type || "image/jpeg"
      });

    if (error) throw error;

    uploadedUrls.push(getPublicUrl(path));
  }

  return uploadedUrls;
}

async function saveCarImages(carId, newUrls) {
  const existing = Array.isArray(window.currentCar?.images) ? window.currentCar.images : [];
  const merged = [...existing, ...newUrls];

  const { error } = await db.from("cars").update({ images: merged }).eq("id", carId);
  if (error) throw error;
}
  








  async function loadCar() {
    const urlParams = new URLSearchParams(window.location.search);
    const carId = urlParams.get("id");

    if (!carId) {
      console.error("No car ID in URL");
      return;
    }

    const { data, error } = await db
      .from("cars")
      .select("*")
      .eq("id", carId)
      .single();

    if (error || !data) {
      console.error("Failed to load car", error);
      return;
    }

    renderCar(data);
applyAdminView();
  }

  function renderCar(car) {
    window.currentCar = car; // so upload functions can access car.id and existing images
    // HEADER
    const title = car.title || `${car.year || ""} ${car.make || ""} ${car.model || ""}`.trim();
    document.querySelector(".car-header h1").textContent = title;
    document.querySelector(".car-price").textContent = `$${car.price ?? ""}`;
    document.querySelector(".car-meta").textContent =
      `${car.mileage ?? "‚Äî"} miles ¬∑ ${car.history_status || "Clean history"}`;

    // DESCRIPTION
    const descEl = document.getElementById("carDescription");
    if (descEl) descEl.textContent = car.description || "No description available.";

    // MAIN IMAGE
    const mainImgEl = document.getElementById("mainImg");
    if (mainImgEl && car.cover_image) {
      mainImgEl.src = car.cover_image;
      mainImgEl.alt = title;
    }

    const imgs = Array.isArray(car.images) ? car.images : [];
const galleryImages = imgs.length ? imgs : (car.cover_image ? [car.cover_image] : []);
PAB_GALLERY.init(galleryImages);

    // SPECS (match by label text)
    document.querySelectorAll(".spec-item").forEach(item => {
      const label = item.querySelector(".spec-label")?.textContent?.trim().toLowerCase();
      const valueEl = item.querySelector(".spec-value");
      if (!label || !valueEl) return;

      if (label.includes("year")) valueEl.textContent = car.year ?? "‚Äî";
      else if (label.includes("make")) valueEl.textContent = car.make ?? "‚Äî";
      else if (label.includes("model")) valueEl.textContent = car.model ?? "‚Äî";
      else if (label.includes("mileage")) valueEl.textContent = car.mileage ? `${car.mileage} mi` : "‚Äî";
      else if (label.includes("engine")) valueEl.textContent = car.engine ?? "‚Äî";
      else if (label.includes("transmission")) valueEl.textContent = car.transmission ?? "‚Äî";
      else if (label.includes("drivetrain")) valueEl.textContent = car.drivetrain ?? "‚Äî";
      else if (label.includes("exterior")) valueEl.textContent = car.exterior_color ?? "‚Äî";
      else if (label.includes("interior")) valueEl.textContent = car.interior_color ?? "‚Äî";
      else if (label.includes("vin")) valueEl.textContent = car.vin ?? "‚Äî";
    });

    // ADMIN BUTTONS (cars.html)
const isAdmin = window.isAdmin && (localStorage.getItem("viewMode") !== "user");

const adminBox = document.getElementById("carAdminActions");
if (adminBox) adminBox.style.display = isAdmin ? "" : "none";

const uploadBox = document.getElementById("carUploadBox");
if (uploadBox) uploadBox.style.display = isAdmin ? "" : "none";


const toggleSoldBtn = document.getElementById("toggleSoldBtn");
if (toggleSoldBtn) {
  toggleSoldBtn.textContent = (car.status === "sold") ? "Unmark Sold" : "Mark Sold";

  toggleSoldBtn.onclick = async () => {
    if (!isAdmin) return;

    const nextStatus = (car.status === "sold") ? "available" : "sold";
    const ok = confirm(`Set status to "${nextStatus}"?`);
    if (!ok) return;

    const { error } = await db.from("cars").update({ status: nextStatus }).eq("id", car.id);
    if (error) { console.error(error); alert("Failed."); return; }

    location.reload();
  };
}


const delBtn = document.getElementById("deleteCarBtn");
if (delBtn) delBtn.onclick = async () => {
  if (!isAdmin) return;

  const ok = confirm("Delete this car forever? (no undo)");
  if (!ok) return;

  const { error } = await db.from("cars").delete().eq("id", car.id);
  if (error) { console.error(error); alert("Failed."); return; }

  window.location.href = "../index.html#cars";
};


const editBtn = document.getElementById("editCarBtn");
if (editBtn) editBtn.onclick = () => {
  if (!isAdmin) return;
  alert("Next step: inline edit form. We wire that after buttons work.");
};


  }

  loadCar();
</script>

<!---------------------GPT END------------------>
<script>
  // One gallery controller. No redeclare wars.
  const PAB_GALLERY = {
    images: [],
    currentIndex: 0,
    init(images) {
      this.images = images.filter(Boolean);
      this.currentIndex = 0;

      const mainImg = document.getElementById("mainImg");
      const thumbsContainer = document.querySelector(".thumbs");
      const dotsContainer = document.getElementById("sliderDots");

      if (!mainImg || !thumbsContainer || !dotsContainer) return;

      // If no images, do nothing
      if (this.images.length === 0) return;

      // Main image
      mainImg.src = this.images[0];

      // Thumbs
      thumbsContainer.innerHTML = this.images.map((url, idx) => `
        <div class="thumb${idx === 0 ? " active" : ""}" data-idx="${idx}">
          <img src="${url}" alt="Photo ${idx + 1}">
        </div>
      `).join("");

      // Dots
      dotsContainer.innerHTML = this.images.map((_, idx) => `
        <div class="dot${idx === 0 ? " active" : ""}" data-idx="${idx}"></div>
      `).join("");

      // Click handlers (thumbs + dots)
      thumbsContainer.querySelectorAll(".thumb").forEach(el => {
        el.addEventListener("click", () => this.goTo(parseInt(el.dataset.idx, 10)));
      });
      dotsContainer.querySelectorAll(".dot").forEach(el => {
        el.addEventListener("click", () => this.goTo(parseInt(el.dataset.idx, 10)));
      });

      // Prev/Next buttons already call changeSlide()
      window.changeSlide = (dir) => {
        if (!this.images.length) return;
        let next = this.currentIndex + dir;
        if (next < 0) next = this.images.length - 1;
        if (next >= this.images.length) next = 0;
        this.goTo(next);
      };

      // Fullscreen (re-uses your existing elements)
      mainImg.onclick = () => {
        const overlay = document.getElementById("fullscreenOverlay");
        const fullImg = document.getElementById("fullscreenImg");
        const counter = document.getElementById("fullscreenCounter");
        if (!overlay || !fullImg || !counter) return;

        fullImg.src = this.images[this.currentIndex];
        counter.textContent = `${this.currentIndex + 1} / ${this.images.length}`;
        overlay.classList.add("active");
      };

      // Fullscreen prev/next
      const fullPrev = document.getElementById("fullscreenPrev");
      const fullNext = document.getElementById("fullscreenNext");
      const fullImg = document.getElementById("fullscreenImg");
      const counter = document.getElementById("fullscreenCounter");

      if (fullPrev) fullPrev.onclick = (e) => { e.stopPropagation(); window.changeSlide(-1); if(fullImg) fullImg.src = this.images[this.currentIndex]; if(counter) counter.textContent = `${this.currentIndex + 1} / ${this.images.length}`; };
      if (fullNext) fullNext.onclick = (e) => { e.stopPropagation(); window.changeSlide(1);  if(fullImg) fullImg.src = this.images[this.currentIndex]; if(counter) counter.textContent = `${this.currentIndex + 1} / ${this.images.length}`; };
    },

    goTo(idx) {
      this.currentIndex = idx;

      const mainImg = document.getElementById("mainImg");
      if (mainImg) mainImg.src = this.images[idx];

      document.querySelectorAll(".thumb").forEach((t, i) => t.classList.toggle("active", i === idx));
      document.querySelectorAll(".dot").forEach((d, i) => d.classList.toggle("active", i === idx));
    }
  };

  // In your renderCar(car), call this at the end:
  // PAB_GALLERY.init(galleryImages);
</script>
<!---------------------Admin Start------------->
<script>
  // Global flag used later for admin-only UI
  window.isAdmin = false;

  function $(id){ return document.getElementById(id); }

async function refreshAuthUI() {
  const { data: { session } } = await db.auth.getSession();
  window.isAdmin = !!session;

  const adminSection = $("adminSection");
  const ownerLoginSection = $("ownerLoginSection");

  const outBox = $("authLoggedOut");
  const inBox  = $("authLoggedIn");
  const emailLabel = $("adminEmailLabel");

  // If logged in: show admin section, hide "Owner Login" button
  if (window.isAdmin) {
    if (adminSection) adminSection.style.display = "";
    if (ownerLoginSection) ownerLoginSection.style.display = "none";
  } else {
    // Logged out: hide admin section (until owner clicks Owner Login)
    if (adminSection) adminSection.style.display = "none";
    if (ownerLoginSection) ownerLoginSection.style.display = "";
  }

  // Logged-in vs logged-out boxes inside admin section
  if (outBox) outBox.style.display = window.isAdmin ? "none" : "";
  if (inBox)  inBox.style.display  = window.isAdmin ? "" : "none";

  if (emailLabel && session?.user?.email) {
    emailLabel.textContent = `Logged in as: ${session.user.email}`;
  }

  applyAdminView();
  updateViewButtons();
}



  async function loginOwner() {
    const email = $("adminEmail")?.value?.trim();
    const password = $("adminPassword")?.value;

    if (!email || !password) {
      alert("Enter email + password.");
      return;
    }

    const { error } = await db.auth.signInWithPassword({ email, password });
    if (error) {
      console.error(error);
      alert("Login failed.");
      return;
    }

    await refreshAuthUI();
  }

  async function logoutOwner() {
    const { error } = await db.auth.signOut();
    if (error) console.error(error);
    await refreshAuthUI();
  }

  // Wire buttons once DOM exists
document.addEventListener("DOMContentLoaded", async () => {
  $("loginBtn")?.addEventListener("click", loginOwner);
  $("logoutBtn")?.addEventListener("click", logoutOwner);

  // ‚úÖ ADD THIS (UPLOAD BUTTON WIRING)
  $("uploadPhotosBtn")?.addEventListener("click", async () => {
    const isAdminEffective = window.isAdmin && (localStorage.getItem("viewMode") !== "user");
    if (!isAdminEffective) return alert("Admin only.");

    const car = window.currentCar;
    if (!car?.id) return alert("Car not loaded yet.");

    const input = $("photoInput");
    const status = $("uploadStatus");
    const btn = $("uploadPhotosBtn");

    const files = input?.files ? Array.from(input.files) : [];
    if (!files.length) return alert("Choose photos first.");

    try {
      btn.disabled = true;
      btn.textContent = "Uploading...";
      if (status) status.textContent = `Compressing + uploading ${files.length} photo(s)...`;

      const urls = await uploadPhotosForCar(car.id, files);

      if (status) status.textContent = `Saving ${urls.length} URL(s) to database...`;
      await saveCarImages(car.id, urls);

      if (status) status.textContent = "Done. Reloading...";
      location.reload();
    } catch (err) {
      console.error(err);
      alert("Upload failed. Check console.");
      if (status) status.textContent = "Upload failed.";
    } finally {
      btn.disabled = false;
      btn.textContent = "Upload Selected Photos";
    }
  });

  await refreshAuthUI();

  db.auth.onAuthStateChange(() => refreshAuthUI());

  $("showOwnerLoginBtn")?.addEventListener("click", () => {
    const adminSection = $("adminSection");
    if (adminSection) adminSection.style.display = "";
    $("ownerLoginSection")?.style && ($("ownerLoginSection").style.display = "none");
    $("authLoggedOut") && ($("authLoggedOut").style.display = "");
    $("authLoggedIn") && ($("authLoggedIn").style.display = "none");
  });
});




  function setViewMode(mode) {
  localStorage.setItem("viewMode", mode);
  updateViewButtons();
  applyAdminView();
}

function getViewMode() {
  return localStorage.getItem("viewMode") || "admin";
}




function updateViewButtons() {
  const mode = getViewMode();
  const userBtn = document.getElementById("viewUserBtn");
  const adminBtn = document.getElementById("viewAdminBtn");

  if (!userBtn || !adminBtn) return;

  if (mode === "admin") {
    adminBtn.classList.add("view-btn-active");
    adminBtn.classList.remove("view-btn-inactive");

    userBtn.classList.add("view-btn-inactive");
    userBtn.classList.remove("view-btn-active");
  } else {
    userBtn.classList.add("view-btn-active");
    userBtn.classList.remove("view-btn-inactive");

    adminBtn.classList.add("view-btn-inactive");
    adminBtn.classList.remove("view-btn-active");
  }
}





document.getElementById("viewUserBtn")?.addEventListener("click", () => {
  setViewMode("user");
});

document.getElementById("viewAdminBtn")?.addEventListener("click", () => {
  setViewMode("admin");
});




function applyAdminView() {
  const mode = getViewMode(); // "admin" or "user"
  const adminEls = document.querySelectorAll(".admin-only");

  const canSeeAdmin = window.isAdmin && mode === "admin";

  adminEls.forEach(el => {
    el.style.display = canSeeAdmin ? "" : "none";
  });
}





updateViewButtons();
applyAdminView();
</script>
<!---------------------Admin End------------->
  </body>
</html>